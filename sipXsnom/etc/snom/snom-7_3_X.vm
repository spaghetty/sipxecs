## calculates setting permission based on its name
#macro( perm $setting )
#set ($pn = $!{setting.ProfileName})
#if ($pn.endsWith('$'))
perm="RW"#elseif ($pn.endsWith('!'))
perm="!"#else
perm="R"#end
#end
<?xml version="1.0"?>
<!-- sipXconfig autogenerated profile for snom Phones -->
<!--  Model $phone.Model.Label Maxlines $phone.Model.MaxLineCount -->
<settings>
	<phone-settings e="2">
#foreach ($group in $phone.Settings.Values)
#if ($group.Name != 'fkeys')
#foreach ($setting in $group.Values)
		<${setting.name} #perm( $setting )>$!{setting.Value}</${setting.name}>
#end
#end
#end
		<ignore_security_warning perm="R">on</ignore_security_warning>
		<dkey_retrieve perm="R">speed 101</dkey_retrieve>

		<!-- speeddial list -->
#foreach ($number in $speedDial)
#set ($i = $velocityCount - 1)
		<speed idx="${i}" perm="R">$number</speed>
#end
		<!-- identities -->
#foreach ($line in $phone.ProfileLines)
#set ($i = $velocityCount)
#foreach ($group in $line.Values)
#foreach ($setting in $group.Values)
		<${setting.name} idx="${i}" #perm( $setting )>$!{setting.Value}</${setting.name}>
#end
#end
#end
	</phone-settings>

	<!-- address book -->
	<tbook e="2">
#foreach ($entry in $phoneBook)
#set ($i = $velocityCount - 1)
#set ($fullName = "$!{entry.FirstName} $!{entry.LastName}")
#set ($fullName = $fullName.trim())
		<item context="active" type="none" index="${i}">
			<name>$esc.xml($!fullName)</name>
			<number>$!{entry.Number}</number>
			<search></search>
		</item>
#end
	</tbook>

	<!-- Function Keys -->
	<functionKeys e="2">
#foreach ($key in $phone.Settings.getSetting('fkeys').Values)
#set ($number = "")
#set ($context = $key.getSetting('context').Value)
#set ($type = $key.getSetting('type').Value)
#set ($number = $key.getSetting('number').Value)
#set ($i = $velocityCount - 1)    
#if ($phone.Model.Label=="Snom 300" && $i>=2 && $i<=4 && $number=="" && $context=="active" && $type=="line" )
#set ($context = "active")
#set ($type = "keyevent")
#if ($i==2)
#set ($number = "F_REDIAL")
#end
#if ($i==3)
#set ($number = "F_ADR_BOOK")
#end
#if ($i==4)
#set ($number = "F_TRANSFER")
#end
#if ($i==5)
#set ($number = "F_MUTE")
#end
#end
#set ($fkeyValue = "$!type $!number")
#set ($fkeyValue = $fkeyValue.trim())
		<fkey idx="${i}" context="$context" perm="R">$!fkeyValue</fkey>
#end
	</functionKeys>
	<!-- Retrieving tftp server to provision web-language and language -->
#set ($ip = $phone.PhoneContext.PhoneDefaults.TftpServer)
     
        <web-languages>
#foreach ($file in $webLang)
		<language url="http://$ip:8090/phone/profile/docroot/snomlang/7_3_X/$file.FileName" name="${file.LangCode}"/>
#end
	</web-languages>

        <!-- Snom Language -->
        <gui-languages>
#foreach ($file in $guiLang)
		<language url="http://$ip:8090/phone/profile/docroot/snomlang/7_3_X/$file.FileName" name="${file.LangCode}"/>
#end
        </gui-languages>

</settings>
